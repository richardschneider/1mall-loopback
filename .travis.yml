language: node_js
env: CI=true
node_js:
  - stable
services:
  - mongodb
before_script:
  - npm install -g gulp
  - npm install -g sally-js
  - mkdir logs
  - mongo --eval "db.adminCommand('listDatabases')"
  - mongo ecom --eval "db.system.indexes.find()"
  - mongo ecom --eval "db.dropDatabase()"
  - ./bin/upgrade-model
  - mongo ecom --eval "db.system.indexes.find()"
script:
  - gulp
  - sally verify logs/*.sal
  - pkg=$(npm pack)
  - npm install -g --quiet $pkg
